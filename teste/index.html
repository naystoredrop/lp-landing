<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VSL</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{ --brand:#ff6a00; --bg:#000; --fg:#fff; }
    *{ box-sizing:border-box }
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; justify-content:center; min-height:100vh; padding:16px;
    }
    .wrap{ width:min(100%,900px); margin:auto }

    /* Caixa no mesmo modelo do seu snippet: VÍDEO VERTICAL 9:16 */
    #vsl-box{
      position:relative; width:100%;
      padding-top:177.7777777778%;   /* 9:16 */
      border-radius:16px; overflow:hidden; background:#000;
      box-shadow:0 10px 40px rgba(0,0,0,.5);
    }
    #vsl-box iframe{
      border:none; position:absolute; top:0; left:0; width:100%; height:100%;
      display:block;
    }

    /* CAPA ÚNICA (GIF) para liberar o áudio */
    .cover{
      position:absolute; inset:0; z-index:10;
      display:flex; align-items:center; justify-content:center;
      transition:opacity .25s ease;
    }
    .cover.hide{ opacity:0; pointer-events:none }
    .cover img{
      width:100%; height:100%; object-fit:cover; display:block;
      user-select:none; -webkit-user-drag:none;
      cursor:pointer;
    }

    /* Barra de progresso estilo VTurb */
    .progress{
      position:absolute; left:0; right:0; bottom:0;
      height:8px; background:rgba(255,255,255,.12); z-index:5;
      box-shadow:0 0 8px rgba(255,106,0,.5);
      pointer-events:none;   /* não bloqueia o player */
    }
    .progress span{
      display:block; height:100%; width:0%;
      background:linear-gradient(90deg,#ff6a00,#ffb347);
      transition:width .2s ease-out;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="vsl-box">
      <!-- CAPA GIF: clique = injeta o IFRAME com autoplay e som -->
      <div class="cover" id="cover">
        <img src="capa%20thumilai.gif" alt="Haz clic para escuchar" id="coverImg">
      </div>
      <!-- Barra de progresso -->
      <div class="progress"><span id="bar"></span></div>
    </div>
  </div>

  <script>
    // ================== CONFIG ==================
    const VIDEO_ID = '10d249a46e42039201d0fec47f6d1f5b';
    const VIDEO_DURATION = 1800; // seg (ajuste para a duração real se quiser)
    // ============================================

    const box = document.getElementById('vsl-box');
    const cover = document.getElementById('cover');
    const bar = document.getElementById('bar');

    // Base do IFRAME — exatamente no formato que você enviou
    const IFRAME_SRC =
      "https://customer-b2gdb94hrid04n5r.cloudflarestream.com/" + VIDEO_ID +
      "/iframe?autoplay=true&poster=" +
      encodeURIComponent("https://customer-b2gdb94hrid04n5r.cloudflarestream.com/" + VIDEO_ID + "/thumbnails/thumbnail.jpg?time=&height=600") +
      "&controls=false";

    function injectIframe(){
      // remove o que houver e injeta o iframe com autoplay
      box.querySelector('iframe')?.remove();
      const iframe = document.createElement('iframe');
      iframe.src = IFRAME_SRC;
      iframe.loading = "lazy";
      iframe.allow = "accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;";
      iframe.allowFullscreen = true;
      iframe.style.cssText = "border:none; position:absolute; top:0; left:0; width:100%; height:100%;";
      box.appendChild(iframe);
    }

    // Barra de progresso visual responsiva (estilo VTurb)
    let anim = null;
    function startProgress(){
      cancelAnimationFrame(anim);
      const t0 = performance.now();
      function step(now){
        const elapsed = (now - t0) / 1000; // s
        const n = Math.min(elapsed / VIDEO_DURATION, 1);
        // acelera início para “mostrar vida” já nos primeiros segundos
        const eased = Math.pow(n, 1/1.8);
        bar.style.width = (eased*100).toFixed(2) + "%";
        if(n < 1){ anim = requestAnimationFrame(step); }
      }
      anim = requestAnimationFrame(step);
    }

    // Clique na capa => injeta o player e inicia a barra
    function play(){
      cover.classList.add('hide');     // some a capa (não cobre o player)
      injectIframe();                  // injeta o iframe com autoplay
      startProgress();                 // anima a barra
    }

    // Eventos de clique/touch (uma vez só, evita duplo injetar)
    cover.addEventListener('click', play, {once:true});
    cover.addEventListener('touchstart', play, {once:true, passive:true});
  </script>
</body>
</html>
