<!-- substitua o trecho do vídeo atual da sua página por este bloco -->
<div class="wrap">
  <div class="vsl" id="vslBox">
    <video id="vsl" playsinline webkit-playsinline preload="metadata"></video>

    <!-- CAPA 1 (GIF para iniciar com som) -->
    <div class="cover" id="cover">
      <img src="capathumilai.gif" alt="Clique para ouvir">
    </div>

    <!-- CAPA 2 (Retomar vídeo) -->
    <div class="resume" id="resume">
      <div class="actions">
        <button class="btn btn-primary" id="btnContinue">▶ Continuar assistindo</button>
        <button class="btn btn-ghost" id="btnRestart">↻ Ver do início</button>
      </div>
    </div>

    <!-- Barra de progresso estilo VTurb -->
    <div class="progress"><span id="bar"></span></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const VIDEO_ID = '10d249a46e42039201d0fec47f6d1f5b';
  const CUSTOMER_SUB = 'customer-b2gdb94hrid04n5r.cloudflarestream.com';
  const HLS_SRC = `https://${CUSTOMER_SUB}/${VIDEO_ID}/manifest/video.m3u8`;
  const RESUME_KEY = `vsl:${VIDEO_ID}:time`;
  const OFFER_AFTER = 15;

  const video = document.getElementById('vsl');
  const cover = document.getElementById('cover');
  const resume = document.getElementById('resume');
  const btnContinue = document.getElementById('btnContinue');
  const btnRestart = document.getElementById('btnRestart');
  const bar = document.getElementById('bar');

  const getSaved = () => Number(localStorage.getItem(RESUME_KEY)) || 0;
  const saveTime = (t) => localStorage.setItem(RESUME_KEY, String(Math.max(0, Math.floor(t||0))));
  const clearTime = () => localStorage.removeItem(RESUME_KEY);

  function loadAndPlay(startSec){
    const startAt = Math.max(0, Number(startSec)||0);
    function setStartAndPlay(){
      const go = () => {
        try { video.currentTime = startAt; } catch(_) {}
        video.muted = false;
        video.play().catch(()=>{});
      };
      if (video.readyState >= 1) { go(); }
      else video.addEventListener('loadedmetadata', go, { once:true });
    }
    if (Hls.isSupported()){
      const hls = new Hls({lowLatencyMode:false});
      hls.loadSource(HLS_SRC);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, setStartAndPlay);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')){
      video.src = HLS_SRC;
      setStartAndPlay();
    } else {
      video.src = HLS_SRC;
      setStartAndPlay();
    }
  }

  (function init(){
    const s = getSaved();
    if (s >= OFFER_AFTER){
      cover.classList.add('hide');
      resume.classList.add('show');
    } else {
      resume.classList.remove('show');
      cover.classList.remove('hide');
    }
  })();

  cover.addEventListener('click', ()=>{
    cover.classList.add('hide');
    resume.classList.remove('show');
    loadAndPlay(0);
  }, {once:true});

  btnContinue.addEventListener('click', ()=>{
    resume.classList.remove('show');
    loadAndPlay(getSaved());
  });
  btnRestart.addEventListener('click', ()=>{
    clearTime();
    resume.classList.remove('show');
    loadAndPlay(0);
  });

  video.addEventListener('timeupdate', ()=>{
    const t = Number(video.currentTime)||0;
    const d = Number(video.duration)||1;
    bar.style.width = Math.min(100, (t/d)*100).toFixed(2) + '%';
    if (!video.paused) saveTime(t);
  });

  video.addEventListener('ended', ()=>{
    bar.style.width = '100%';
    clearTime();
  });

  window.addEventListener('beforeunload', ()=>{
    saveTime(Number(video.currentTime)||0);
  });
</script>

<style>
  :root{ --brand:#ff6a00; --bg:#000; --fg:#fff; }
  .wrap{ width:min(100%,900px); margin:auto }
  .vsl{ position:relative; width:100%; padding-top:177.7777%; border-radius:16px; overflow:hidden; background:#000; }
  video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; background:#000; }
  .cover{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; transition:opacity .25s; z-index:10; }
  .cover.hide{ opacity:0; pointer-events:none }
  .cover img{ width:100%; height:100%; object-fit:cover; cursor:pointer; }
  .resume{ position:absolute; inset:0; display:none; background:url('capathumilaicontinuar.png') center/cover no-repeat #000; z-index:11; }
  .resume.show{ display:block }
  .actions{ position:absolute; bottom:8%; left:0; right:0; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
  .btn{ padding:12px 18px; border-radius:999px; font-weight:800; font-size:18px; cursor:pointer; border:2px solid transparent; }
  .btn-primary{ background:var(--brand); color:#000 }
  .btn-ghost{ background:#00000088; color:#fff; border-color:#ffffff44 }
  .progress{ position:absolute; left:0; right:0; bottom:0; height:8px; background:rgba(255,255,255,.12); }
  .progress span{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#ff6a00,#ffb347); transition:width .18s; }
</style>
