<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VSL</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --brand:#ff6a00; /* cor da barra/CTAs */
      --bg:#000; --fg:#fff; --card:#121212;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; justify-content:center; min-height:100vh; padding:18px;
    }
    .wrap{width:min(100%,1000px); margin:auto}
    .player{
      position:relative; width:100%; aspect-ratio:16/9;
      background:#000; border-radius:18px; overflow:hidden;
      box-shadow:0 10px 40px rgba(0,0,0,.45);
    }

    /* iframe responsivo (mesmo estilo que você mandou) */
    .iframe-box{position:relative; width:100%; height:100%}
    .iframe-pad{position:relative; padding-top:125%; width:100%; height:100%}
    .iframe-pad iframe{
      border:none; position:absolute; top:0; left:0; width:100%; height:100%;
    }

    /* CAPA 1: clicar para ativar som */
    .cover, .resume{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:#000; z-index:10; transition:opacity .25s ease;
    }
    .cover.hidden, .resume.hidden{opacity:0; pointer-events:none}
    .cover img, .resume img{
      width:100%; height:100%; object-fit:cover; user-select:none; -webkit-user-drag:none;
    }
    .cover .tap{
      position:absolute; inset:0; cursor:pointer; /* toda a capa é clicável */
    }

    /* CAPA 2: retomada (botões sobre a imagem) */
    .resume .actions{
      position:absolute; width:100%; left:0; bottom:8%;
      display:flex; gap:12px; justify-content:center; flex-wrap:wrap; padding:0 16px;
    }
    .btn{
      padding:12px 18px; border-radius:999px; border:2px solid transparent;
      font-weight:800; cursor:pointer; font-size:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    .btn-primary{background:var(--brand); color:#000}
    .btn-ghost{background:#00000088; color:#fff; border-color:#ffffff44}

    /* barra de progresso */
    .progress{position:absolute; left:0; right:0; bottom:0; height:6px; background:#ffffff22}
    .progress span{position:absolute; inset:0; width:0%; background:var(--brand); transition:width .25s linear}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="player" id="box">
      <!-- IFRAME (será injetado via JS com o tempo correto) -->
      <div class="iframe-box">
        <div class="iframe-pad" id="iframePad"></div>
      </div>

      <!-- CAPA 1 — clicar para ativar som -->
      <div class="cover" id="cover">
        <img src="capa%20thumilai.gif" alt="Haz clic para escuchar"
             onerror="this.src='capa%20thumilai.png'">
        <div class="tap" title="Haz clic para escuchar"></div>
      </div>

      <!-- CAPA 2 — retomada continuar/reiniciar -->
      <div class="resume hidden" id="resume">
        <img src="capa%20thumilai.png" alt="Continuar o reiniciar">
        <div class="actions">
          <button class="btn btn-primary" id="btnContinue">▶ Continuar viendo</button>
          <button class="btn btn-ghost"   id="btnRestart">↻ Ver desde el inicio</button>
        </div>
      </div>

      <!-- Barra de progresso -->
      <div class="progress" aria-hidden="true"><span id="bar"></span></div>
    </div>
  </div>

  <script>
    // =================== CONFIG ===================
    const VIDEO_ID   = '10d249a46e42039201d0fec47f6d1f5b';
    const RESUME_KEY = `vsl:${VIDEO_ID}:time`;
    const MIN_SECONDS_TO_OFFER_RESUME = 15;

    // Duração estimada (em segundos) — coloque a real do seu vídeo para a barra ficar 100% precisa
    const VIDEO_DURATION = 1800; // 30 min; ajuste conforme seu vídeo
    // ===============================================

    const cover    = document.getElementById('cover');
    const resume   = document.getElementById('resume');
    const bar      = document.getElementById('bar');
    const pad      = document.getElementById('iframePad');
    const tapArea  = cover.querySelector('.tap');
    const btnContinue = document.getElementById('btnContinue');
    const btnRestart  = document.getElementById('btnRestart');

    // Base do iframe que você mandou
    const IFRAME_BASE =
      `https://customer-b2gdb94hrid04n5r.cloudflarestream.com/${VIDEO_ID}/iframe` +
      `?autoplay=true&poster=${encodeURIComponent(`https://customer-b2gdb94hrid04n5r.cloudflarestream.com/${VIDEO_ID}/thumbnails/thumbnail.jpg?time=&height=600`)}&controls=false`;

    // helpers de progresso
    const getSaved = () => Number(localStorage.getItem(RESUME_KEY)) || 0;
    const saveTime = (t) => localStorage.setItem(RESUME_KEY, String(Math.max(0, Math.floor(t||0))));
    const clearTime= () => localStorage.removeItem(RESUME_KEY);

    // cria/atualiza o iframe começando em "startSec"
    function mountIframe(startSec){
      const start = Math.max(0, Math.floor(Number(startSec)||0));
      const src   = `${IFRAME_BASE}#t=${start}`; // media fragment para iniciar do tempo salvo
      pad.innerHTML = `
        <div style="position: relative; padding-top: 125%;">
          <iframe
            src="${src}"
            loading="lazy"
            style="border:none; position:absolute; top:0; left:0; width:100%; height:100%;"
            allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
            allowfullscreen="true">
          </iframe>
        </div>
      `;
    }

    // Timer local para medir playhead (não temos acesso ao tempo interno do iframe)
    let ticker = null;
    function startTicker(fromSec){
      stopTicker();
      let t = Math.max(0, Number(fromSec)||0);
      const step = 0.5; // segundos
      ticker = setInterval(()=>{
        t += step;
        saveTime(t);
        if (VIDEO_DURATION > 0){
          const pct = Math.min(100, (t/VIDEO_DURATION)*100);
          bar.style.width = pct + '%';
        }
      }, step*1000);
      // salva também ao trocar de aba/sair
      window.onbeforeunload = () => saveTime(t);
      document.addEventListener('visibilitychange', ()=>{ if(document.hidden) saveTime(t); }, {once:false});
    }
    function stopTicker(){
      if (ticker){ clearInterval(ticker); ticker = null; }
    }

    // Decide qual capa mostrar ao carregar
    (function init(){
      const saved = getSaved();
      if (saved >= MIN_SECONDS_TO_OFFER_RESUME){
        cover.classList.add('hidden');
        resume.classList.remove('hidden');
      } else {
        resume.classList.add('hidden');
        cover.classList.remove('hidden');
      }
      // monta um iframe "silencioso" default (não toca até clicar)
      // aqui deixamos sem autoplay (evita tocar sem consentimento). Vai ser substituído no clique.
      pad.innerHTML = '';
    })();

    // CAPA 1: clique para iniciar com som do zero
    tapArea.addEventListener('click', ()=>{
      cover.classList.add('hidden');
      resume.classList.add('hidden');
      const startAt = 0;
      mountIframe(startAt);
      startTicker(startAt);
    });

    // CAPA 2: continuar/reiniciar
    btnContinue.addEventListener('click', ()=>{
      resume.classList.add('hidden');
      const startAt = getSaved();
      mountIframe(startAt);
      startTicker(startAt);
    });
    btnRestart.addEventListener('click', ()=>{
      clearTime();
      resume.classList.add('hidden');
      const startAt = 0;
      mountIframe(startAt);
      startTicker(startAt);
    });

    // Se quiser resetar ao final manualmente (sem API do player), quando atingir a duração:
    if (VIDEO_DURATION > 0){
      setInterval(()=>{
        const t = getSaved();
        if (t >= VIDEO_DURATION - 1){
          clearTime();
          bar.style.width = '100%';
        }
      }, 1000);
    }
  </script>
</body>
</html>
