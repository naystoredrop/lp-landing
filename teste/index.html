<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VSL Alta Conversión</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --brand:#ff6a00;
      --bg:#000;
      --fg:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; justify-content:center; min-height:100vh; padding:16px;
    }
    .wrap{width:min(100%,900px); margin:auto}
    #vsl-box{
      position:relative; width:100%; padding-top:177.7777777778%;
      border-radius:16px; overflow:hidden; background:#000;
      box-shadow:0 10px 40px rgba(0,0,0,.5);
    }
    #vsl-box iframe{
      border:none; position:absolute; top:0; left:0; width:100%; height:100%;
    }
    /* Capas */
    .layer{
      position:absolute; inset:0; z-index:10;
      display:flex; align-items:center; justify-content:center;
      transition:opacity .25s ease;
    }
    .hide{opacity:0; pointer-events:none}
    .layer img{
      width:100%; height:100%; object-fit:cover;
      user-select:none; -webkit-user-drag:none;
    }
    .tap{position:absolute; inset:0; cursor:pointer}
    /* Barra estilo VTurb */
    .progress{
      position:absolute; left:0; right:0; bottom:0;
      height:8px; background:rgba(255,255,255,.12);
      box-shadow:0 0 8px rgba(255,106,0,.5);
      z-index:5;
    }
    .progress span{
      display:block; height:100%; width:0%;
      background:linear-gradient(90deg,#ff6a00,#ffb347);
      transition:width .25s ease-out;
    }
    /* Botões da capa 2 */
    .actions{
      position:absolute; left:0; right:0; bottom:8%;
      display:flex; gap:12px; justify-content:center; padding:0 16px; flex-wrap:wrap;
    }
    .btn{
      padding:12px 18px; border-radius:999px; border:2px solid transparent;
      font-weight:800; font-size:18px; cursor:pointer;
    }
    .btn-primary{background:var(--brand); color:#000;}
    .btn-ghost{background:#00000088; color:#fff; border-color:#ffffff44;}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="vsl-box">
      <!-- Capa 1: GIF para ativar o som -->
      <div class="layer" id="cover1">
        <img src="capa%20thumilai.gif" alt="Haz clic para escuchar" onerror="this.src='capa%20thumilai.png'">
        <div class="tap" title="Haz clic para escuchar"></div>
      </div>

      <!-- Capa 2: PNG ao recarregar -->
      <div class="layer hide" id="cover2">
        <img src="capa%20thumilai.png" alt="Continuar o reiniciar">
        <div class="actions">
          <button class="btn btn-primary" id="btnContinue">▶ Continuar viendo</button>
          <button class="btn btn-ghost" id="btnRestart">↻ Ver desde el inicio</button>
        </div>
      </div>

      <!-- Barra de progresso -->
      <div class="progress"><span id="bar"></span></div>
    </div>
  </div>

  <script>
    // ================= CONFIG =================
    const VIDEO_ID   = '10d249a46e42039201d0fec47f6d1f5b';
    const RESUME_KEY = `vsl:${VIDEO_ID}:time`;
    const MIN_SECONDS_TO_OFFER = 15;   // tempo mínimo antes de oferecer "continuar"
    const VIDEO_DURATION = 1800;       // duração estimada (segundos)
    // ==========================================

    const box = document.getElementById('vsl-box');
    const cover1 = document.getElementById('cover1');
    const cover2 = document.getElementById('cover2');
    const bar = document.getElementById('bar');
    const btnContinue = document.getElementById('btnContinue');
    const btnRestart  = document.getElementById('btnRestart');

    const IFRAME_BASE =
      `https://customer-b2gdb94hrid04n5r.cloudflarestream.com/${VIDEO_ID}/iframe` +
      `?autoplay=true&controls=false&playsinline=true` +
      `&poster=${encodeURIComponent('https://customer-b2gdb94hrid04n5r.cloudflarestream.com/'+VIDEO_ID+'/thumbnails/thumbnail.jpg?time=&height=600')}`;

    const getSaved = () => Number(localStorage.getItem(RESUME_KEY)) || 0;
    const saveTime = (t) => localStorage.setItem(RESUME_KEY, String(Math.max(0, Math.floor(t||0))));
    const clearTime = () => localStorage.removeItem(RESUME_KEY);

    // Cria e injeta o iframe
    function mountIframe(startSec){
      const start = Math.max(0, Math.floor(Number(startSec)||0));
      const src = `${IFRAME_BASE}#t=${start}`;
      box.querySelector('iframe')?.remove();
      const iframe = document.createElement('iframe');
      iframe.src = src;
      iframe.loading = "lazy";
      iframe.allow = "autoplay; fullscreen; encrypted-media; picture-in-picture; accelerometer; gyroscope";
      iframe.allowFullscreen = true;
      iframe.style.cssText = "border:none; position:absolute; top:0; left:0; width:100%; height:100%;";
      box.appendChild(iframe);
    }

    // Barra responsiva tipo VTurb
    let barAnim = null;
    function startProgress(fromSec){
      cancelAnimationFrame(barAnim);
      const start = Math.max(0, fromSec);
      const startTime = performance.now();
      const duration = VIDEO_DURATION * 1000;
      const smoothFactor = 1.8; // acelera no início
      function step(now){
        const elapsed = (now - startTime)/1000 + start;
        const normalized = Math.min(elapsed/VIDEO_DURATION,1);
        const eased = Math.pow(normalized,1/smoothFactor);
        bar.style.width = (eased*100).toFixed(2) + "%";
        saveTime(elapsed);
        if(normalized<1) barAnim=requestAnimationFrame(step);
      }
      barAnim=requestAnimationFrame(step);
    }

    // Decide qual capa mostrar ao carregar
    (function init(){
      const saved = getSaved();
      if(saved >= MIN_SECONDS_TO_OFFER){
        cover1.classList.add('hide');
        cover2.classList.remove('hide');
      }else{
        cover2.classList.add('hide');
        cover1.classList.remove('hide');
      }
    })();

    // Capa 1 (GIF) — iniciar vídeo do zero
    cover1.addEventListener('click', ()=>{
      cover1.classList.add('hide');
      cover2.classList.add('hide');
      mountIframe(0);
      startProgress(0);
    }, {once:true});

    // Capa 2 (PNG) — continuar ou reiniciar
    btnContinue.addEventListener('click', ()=>{
      cover2.classList.add('hide');
      const s=getSaved();
      mountIframe(s);
      startProgress(s);
    });
    btnRestart.addEventListener('click', ()=>{
      clearTime();
      cover2.classList.add('hide');
      mountIframe(0);
      startProgress(0);
    });

    // Se atingir a duração total, zera o progresso
    setInterval(()=>{
      const t=getSaved();
      if(t>=VIDEO_DURATION-1){ clearTime(); bar.style.width='100%'; }
    },1000);
  </script>
</body>
</html>
