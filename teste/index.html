<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PainControl — VSL</title>
  <meta name="robots" content="noindex,nofollow" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    *{box-sizing:border-box}
    body{
      margin:0; background:#000; color:#fff;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .container{ max-width:1000px; margin:0 auto; padding:16px }

    /* Título opcional (pode remover) */
    .title{ text-align:center; margin:8px 0 16px }
    .title h1{ margin:0; font-size:clamp(22px,4vw,32px); font-weight:800 }

    /* ====== VSL 100% ====== */
    :root{ --brand:#ff6a00 }
    .vsl{
      position:relative; width:100%; padding-top:177.7777777778%;
      border-radius:16px; overflow:hidden; background:#000;
      box-shadow:0 10px 40px rgba(0,0,0,.5);
    }
    video{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; background:#000; display:block; border:0;
    }

    /* CAPA 1 (GIF) */
    .cover{
      position:absolute; inset:0; z-index:10;
      display:flex; align-items:center; justify-content:center;
      transition:opacity .25s ease;
    }
    .cover.hide{ opacity:0; pointer-events:none }
    .cover img{
      width:100%; height:100%; object-fit:cover; display:block; cursor:pointer;
      user-select:none; -webkit-user-drag:none;
    }

    /* CAPA 2 (PNG de continuar) */
    .resume{
      position:absolute; inset:0; z-index:11; display:none;
      background:url('capathumilaicontinuar.png') center/cover no-repeat #000;
    }
    .resume.show{ display:block }
    .actions{
      position:absolute; left:0; right:0; bottom:8%;
      display:flex; gap:12px; justify-content:center; flex-wrap:wrap; padding:0 16px;
    }
    .btn{
      padding:12px 18px; border-radius:999px; border:2px solid transparent;
      font-weight:800; font-size:18px; cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    .btn-primary{ background:var(--brand); color:#000 }
    .btn-ghost{ background:#00000088; color:#fff; border-color:#ffffff44 }

    /* Barra VTurb */
    .progress{
      position:absolute; left:0; right:0; bottom:0; z-index:5;
      height:8px; background:rgba(255,255,255,.12);
      box-shadow:0 0 8px rgba(255,106,0,.5);
      pointer-events:none;
    }
    .progress span{
      display:block; height:100%; width:0%;
      background:linear-gradient(90deg,#ff6a00,#ffb347);
      transition:width .18s ease-out;
    }
  </style>
</head>
<body>
  <main class="container">
    <div class="title"><h1>PainControl — VSL</h1></div>

    <section class="vsl" id="vslBox">
      <video id="vsl" playsinline webkit-playsinline preload="metadata"></video>

      <!-- CAPA 1: GIF -->
      <div class="cover" id="cover">
        <img src="capathumilai.gif" alt="Clique para ouvir">
      </div>

      <!-- CAPA 2: PNG (retomar) -->
      <div class="resume" id="resume">
        <div class="actions">
          <button class="btn btn-primary" id="btnContinue">▶ Continuar assistindo</button>
          <button class="btn btn-ghost" id="btnRestart">↻ Ver do início</button>
        </div>
      </div>

      <!-- Barra -->
      <div class="progress"><span id="bar"></span></div>
    </section>
  </main>

  <script>
    /************* CONFIG *************/
    const VIDEO_ID     = '10d249a46e42039201d0fec47f6d1f5b';
    const CUSTOMER_SUB = 'customer-b2gdb94hrid04n5r.cloudflarestream.com';
    const HLS_SRC      = `https://${CUSTOMER_SUB}/${VIDEO_ID}/manifest/video.m3u8`;
    const RESUME_KEY   = `vsl:${VIDEO_ID}:time`;
    const OFFER_AFTER  = 15; // só oferece "continuar" após 15s assistidos
    /**********************************/

    const video       = document.getElementById('vsl');
    const cover       = document.getElementById('cover');
    const resume      = document.getElementById('resume');
    const btnContinue = document.getElementById('btnContinue');
    const btnRestart  = document.getElementById('btnRestart');
    const bar         = document.getElementById('bar');

    const getSaved  = () => Number(localStorage.getItem(RESUME_KEY)) || 0;
    const saveTime  = (t) => localStorage.setItem(RESUME_KEY, String(Math.max(0, Math.floor(t||0))));
    const clearTime = () => localStorage.removeItem(RESUME_KEY);

    // Carrega HLS e inicia no ponto desejado (sempre dentro de clique)
    function loadAndPlay(startSec){
      const startAt = Math.max(0, Number(startSec)||0);

      function setStartAndPlay(){
        const go = () => {
          try { video.currentTime = startAt; } catch(_) {}
          video.muted = false;
          video.play().catch(()=>{});
        };
        if (video.readyState >= 1) { go(); }
        else video.addEventListener('loadedmetadata', go, { once:true });
      }

      if (window.Hls && Hls.isSupported()){
        const hls = new Hls({lowLatencyMode:false});
        hls.loadSource(HLS_SRC);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, setStartAndPlay);
      } else if (video.canPlayType('application/vnd.apple.mpegurl')){
        video.src = HLS_SRC; setStartAndPlay();
      } else {
        video.src = HLS_SRC; setStartAndPlay();
      }
    }

    // Decide capa ao abrir
    (function init(){
      const s = getSaved();
      if (s >= OFFER_AFTER){
        cover.classList.add('hide');
        resume.classList.add('show');
      } else {
        resume.classList.remove('show');
        cover.classList.remove('hide');
      }
    })();

    // Capa GIF → iniciar do zero
    cover.addEventListener('click', ()=>{
      cover.classList.add('hide');
      resume.classList.remove('show');
      loadAndPlay(0);
    }, {once:true});

    // Capa PNG → continuar ou reiniciar
    btnContinue.addEventListener('click', ()=>{
      resume.classList.remove('show');
      loadAndPlay(getSaved());
    });
    btnRestart.addEventListener('click', ()=>{
      clearTime();
      resume.classList.remove('show');
      loadAndPlay(0);
    });

    // Barra + salvamento com tempo real
    video.addEventListener('timeupdate', ()=>{
      const t = Number(video.currentTime)||0;
      const d = Number(video.duration)||1;
      bar.style.width = Math.min(100, (t/d)*100).toFixed(2) + '%';
      if (!video.paused) saveTime(t);
    });

    video.addEventListener('ended', ()=>{
      bar.style.width = '100%';
      clearTime();
    });

    window.addEventListener('beforeunload', ()=>{
      saveTime(Number(video.currentTime)||0);
    });
  </script>
</body>
</html>
